(function(){"use strict";angular.module("fc.startup").controller("HierarchyConfigCtrl",e);e.$inject=["$modal","$scope","$state","appConfig","configSvc","dataContextSvc","lodash"];function e(e,n,t,l,o,r,a){var i=this;var c=9;var f=2;i.activate=u;i.addLevelAfter=v;i.canAddLevelAfter=d;i.canRemoveLevel=s;i.levels=null;i.removeLevel=g;i.titleKey="fc.startup.config.hierarchy.PAGE_TITLE";i.validate=m;i.validLevel=C;u();function u(){r.getConfig().then(function(n){if(n.hierarchy.completed){var l=e.open({templateUrl:"common/modal.template.html",controller:"ModalTemplateCtrl",controllerAs:"modalCtrl",resolve:{data:function(){return{bodyTextKey:"fc.startup.config.hierarchy.configCompleteModal.COMPLETE_MODAL_CONTENT",cancelKey:"fc.NO_TEXT",okKey:"fc.YES_TEXT",titleKey:"fc.startup.config.hierarchy.configCompleteModal.COMPLETE_MODAL_TITLE"}}}});l.result.then(function(){p()},function(){t.go("vertical-config")})}else{p()}})}function v(e){if(!d(e)||!C(e)){return}var n={open:true,data:{}};var t=i.levels.indexOf(e);t++;i.levels.splice(t,0,n)}function d(e){var n=false;if(!e||e.pin===f){return n}n=i.levels.length<c&&e.pin!==f;return n}function s(e){return!e.pin}function p(e){r.getConfig().then(function(){i.levels=o.config.hierarchy.levels;i.levels[0].open=true;n.$on(l.languageChanged,function(e,n){p(n)})})}function g(e){if(!s(e)){return}var n=i.levels.indexOf(e);i.levels.splice(n,1)}function h(){}function m(){return a.all(i.levels,function(e){return i.validLevel(e)})}function C(e){return Boolean(e.description&&e.data&&e.data.name&&e.data.code)}}})();