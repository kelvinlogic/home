(function(){"use strict";angular.module("fc.configuration").controller("HierarchyConfigCtrl",e);e.$inject=["$modal","$scope","$state","appConfig","configSvc","dataContextSvc","lodash"];function e(e,t,n,a,l,i,r){var o=this;var c=9;var u=2;o.activate=f;o.addCustomField=d;o.addLevelAfter=s;o.canAddCustomField=v;o.canAddLevelAfter=m;o.canRemoveLevel=g;o.levels=null;o.removeField=p;o.removeLevel=C;o.titleKey="fc.configuration.hierarchy.PAGE_TITLE";o.validate=T;o.validLevel=F;f();function f(){i.getConfig().then(function(t){if(t.hierarchy.completed){var a=e.open({templateUrl:"common/modal.template.html",controller:"ModalTemplateCtrl as modalCtrl",resolve:{data:function(){return{bodyTextKey:"fc.startup.config.hierarchy.configCompleteModal.COMPLETE_MODAL_CONTENT",cancelKey:"fc.NO_TEXT",okKey:"fc.YES_TEXT",titleKey:"fc.startup.config.hierarchy.configCompleteModal.COMPLETE_MODAL_TITLE"}}}});a.result.then(function(){h()},function(){n.go("vertical-config")})}else{h()}})}function d(e){if(!v(e)){return}e.data.customFields.push({})}function s(e){if(!m(e)||!F(e)){return}var t={open:true,data:{customFields:[]}};var n=o.levels.indexOf(e);n++;o.levels.splice(n,0,t)}function v(e){if(!e){return false}if(!e.data){e.data={}}if(!e.data.customFields||!r.isArray(e.data.customFields)){e.data.customFields=[];return true}if(e.data.customFields.length&&e.data.customFields.length>=8){return false}var t=r.any(e.data.customFields,function(e){return!e.name||!e.value});if(t){return false}return true}function m(e){var t=false;if(!e||e.pin===u){return t}t=o.levels.length<c&&e.pin!==u;return t}function g(e){return!e.pin}function h(e){i.getConfig().then(function(){o.levels=l.config.hierarchy.levels;o.levels[0].open=true;t.$on(a.languageChanged,function(e,t){h(t)})})}function p(e,t){if(!g(e)){return}var n=e.data.customFields.indexOf(t);e.data.customFields.splice(n,1)}function C(e){if(!g(e)){return}var t=o.levels.indexOf(e);o.levels.splice(t,1)}function y(){}function T(){return r.all(o.levels,function(e){return o.validLevel(e)})}function F(e){return Boolean(e.description&&e.data&&e.data.name&&e.data.code)}}})();