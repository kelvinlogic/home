(function(){"use strict";angular.module("fc.configuration").controller("HierarchyConfigCtrl",e);e.$inject=["$modal","$scope","$state","appConfig","configSvc","lodash"];function e(e,t,n,a,l,i){var r=this;var o=9;var c=2;r.activate=u;r.addCustomField=f;r.addLevelAfter=d;r.canAddCustomField=s;r.canAddLevelAfter=v;r.canRemoveLevel=m;r.levels=null;r.removeField=p;r.removeLevel=y;r.save=C;r.titleKey="fc.configuration.hierarchy.PAGE_TITLE";r.validate=T;r.validLevel=F;u();function u(){t.$on(a.languageChanged,h)}function f(e){if(!s(e)){return}e.data.customFields.push({})}function d(e){if(!v(e)||!F(e)){return}var t={open:true,data:{customFields:[]}};var n=r.levels.indexOf(e);n++;r.levels.splice(n,0,t)}function s(e){if(!e){return false}if(!m(e)){return false}if(!e.data){e.data={}}if(!e.data.customFields||!i.isArray(e.data.customFields)){e.data.customFields=[];return true}if(e.data.customFields.length&&e.data.customFields.length>=8){return false}var t=i.any(e.data.customFields,function(e){return!e.name||!e.value});if(t){return false}return true}function v(e){var t=false;if(!e||e.pin===c){return t}t=r.levels.length<o&&e.pin!==c;return t}function m(e){return!e.pin}function h(){l.getConfig().then(function(t){if(t.hierarchy.completed){var a=e.open({templateUrl:"common/modal.tpl.html",controller:"ModalTemplateCtrl as modalCtrl",resolve:{data:function(){return{bodyTextKey:"fc.configuration.hierarchy.configCompleteModal.COMPLETE_MODAL_CONTENT",cancelKey:"fc.NO_TEXT",okKey:"fc.YES_TEXT",titleKey:"fc.configuration.hierarchy.configCompleteModal.COMPLETE_MODAL_TITLE"}}}});a.result.then(function(){g(t)},function(){n.go("vertical-config")})}else{g(t)}})}function g(e){r.levels=e.hierarchy.levels;r.levels[0].open=true}function p(e,t){if(!m(e)){return}var n=e.data.customFields.indexOf(t);e.data.customFields.splice(n,1)}function y(e){if(!m(e)){return}var t=r.levels.indexOf(e);r.levels.splice(t,1)}function C(){}function T(){return i.all(r.levels,function(e){return r.validLevel(e)})}function F(e){return Boolean(e.description&&e.data&&e.data.name&&e.data.code)}}})();